{ @author: Sylvain Maltais (support@gladir.com)
  @created: 2026
  @website(https://www.gladir.com/linux-0)
  @abstract(Target: Free Pascal 3.2, Turbo Pascal 7)
}

Program A2P;

Uses DOS;

Type
 TOption = Set of (OptDebug, OptFieldSep, OptFields, OptNumber, OptOutput);

Var
 Language:(_French,_English,_Germany,_Italian,_Spain);
 TmpLanguage:String;
 Options:TOption;
 DebugLevel:Integer;
 FieldSeparator:Char;
 FieldList:String;
 MaxRecords:Integer;
 OutputFile:String;
 InputFile:String;
 SourceAWK:Text;
 TargetPerl:Text;
 CurrLine:String;
 LineNumber:Integer;

Function StrToUpper(S:String):String;
Var
 I:Byte;
Begin
 For I:=1 to Length(S)do Begin
  If S[I] in['a'..'z']Then S[I]:=Chr(Ord(S[I])-32);
 End;
 StrToUpper:=S;
End;

Function TrimL(S:String):String;
Var
 I:Byte;
Begin
 For I:=1to Length(S)do Begin
  If S[I]<>' 'Then Begin
   TrimL:=Copy(S,I,255);
   Exit;
  End;
 End;
 TrimL:='';
End;

Function ConvertAWKLine(Line:String):String;
Var
 Result:String;
 I:Integer;
Begin
 Result:=Line;

 { Conversion des variables AWK vers Perl }
 While Pos('$1',Result)>0 do Begin
  I:=Pos('$1',Result);
  Delete(Result,I,2);
  Insert('$F[0]',Result,I);
 End;

 While Pos('$2',Result)>0 do Begin
  I:=Pos('$2',Result);
  Delete(Result,I,2);
  Insert('$F[1]',Result,I);
 End;

 While Pos('$3',Result)>0 do Begin
  I:=Pos('$3',Result);
  Delete(Result,I,2);
  Insert('$F[2]',Result,I);
 End;

 While Pos('$4',Result)>0 do Begin
  I:=Pos('$4',Result);
  Delete(Result,I,2);
  Insert('$F[3]',Result,I);
 End;

 { Conversion print vers print Perl }
 While Pos('print ',Result)>0 do Begin
  I:=Pos('print ',Result);
  Delete(Result,I,6);
  Insert('print ',Result,I);
 End;

 { Conversion BEGIN vers BEGIN Perl }
 While Pos('BEGIN',Result)>0 do Begin
  I:=Pos('BEGIN',Result);
  Delete(Result,I,5);
  Insert('BEGIN',Result,I);
 End;

 { Conversion END vers END Perl }
 While Pos('END',Result)>0 do Begin
  I:=Pos('END',Result);
  Delete(Result,I,3);
  Insert('END',Result,I);
 End;

 ConvertAWKLine:=Result;
End;

Procedure ProcessAWKFile;
Begin
 If InputFile<>''Then Begin
  Assign(SourceAWK,InputFile);
  {$I-}Reset(SourceAWK);{$I+}
  If IOResult<>0Then Begin
   Case Language of
    _English:WriteLn('File not found: ',InputFile);
    _Germany:WriteLn('Datei nicht gefunden: ',InputFile);
    _Italian:WriteLn('File non trovato: ',InputFile);
    _Spain:WriteLn('Archivo no encontrado: ',InputFile);
    Else WriteLn('Fichier introuvable : ',InputFile);
   End;
   Exit;
  End;
 End;

 If OptOutput in Options Then Begin
  If OutputFile=''Then OutputFile:='a2p_output.pl';
  Assign(TargetPerl,OutputFile);
  {$I-}Rewrite(TargetPerl);{$I+}
  If IOResult<>0Then Begin
   Case Language of
    _English:WriteLn('Cannot create output file: ',OutputFile);
    _Germany:WriteLn('Kann Ausgabedatei nicht erstellen: ',OutputFile);
    _Italian:WriteLn('Impossibile creare il file di output: ',OutputFile);
    _Spain:WriteLn('No se puede crear el archivo de salida: ',OutputFile);
    Else WriteLn('Impossible de cr‚er le fichier de sortie : ',OutputFile);
   End;
   Exit;
  End;
 End;
  { Entete Perl }
 If OptOutput in Options Then Begin
  WriteLn(TargetPerl,'#!/usr/bin/perl');
  WriteLn(TargetPerl,'# Generated by A2P from AWK script');
  WriteLn(TargetPerl,'');
  If FieldSeparator<>' 'Then Begin
   WriteLn(TargetPerl,'$FS = "',FieldSeparator,'";');
  End
   Else
  WriteLn(TargetPerl,'$FS = " ";');
  WriteLn(TargetPerl,'');
 End
  Else
 Begin
  WriteLn('#!/usr/bin/perl');
  WriteLn('# Generated by A2P from AWK script');
  WriteLn('');
  If FieldSeparator<>' 'Then Begin
   WriteLn('$FS = "',FieldSeparator,'";');
  End
   Else
  WriteLn('$FS = " ";');
  WriteLn('');
 End;
 LineNumber:=0;
 While Not EOF(SourceAWK)do Begin
  ReadLn(SourceAWK,CurrLine);
  Inc(LineNumber);
  If MaxRecords>0Then Begin
   If LineNumber>MaxRecords Then Break;
  End;
  CurrLine:=ConvertAWKLine(CurrLine);
  If OptDebug in Options Then Begin
   Case Language of
    _English:WriteLn('Line ',LineNumber,': ',CurrLine);
    _Germany:WriteLn('Zeile ',LineNumber,': ',CurrLine);
    _Italian:WriteLn('Riga ',LineNumber,': ',CurrLine);
    _Spain:WriteLn('Linea ',LineNumber,': ',CurrLine);
    Else WriteLn('Ligne ',LineNumber,': ',CurrLine);
   End;
  End;
  If OptOutput in Options Then Begin
   WriteLn(TargetPerl,CurrLine);
  End
   Else
  WriteLn(CurrLine);
 End;

 If InputFile<>''Then Close(SourceAWK);
 If OptOutput in Options Then Close(TargetPerl);
End;

Procedure ParseParameters;
Var
 I:Integer;
 Param:String;
 Err:Word;
 Value:Integer;
Begin
 For I:=1 to ParamCount do Begin
  Param:=ParamStr(I);
  If Length(Param)>1Then Begin
   If Param[1]='-'Then Begin
    Case Param[2]of
     'D':Begin
      Options:=Options+[OptDebug];
      If Length(Param)>2Then Begin
       Val(Copy(Param,3,255),Value,Err);
       If Err=0Then DebugLevel:=Value;
      End;
     End;
     'F':Begin
      Options:=Options+[OptFieldSep];
      If Length(Param)>2Then FieldSeparator:=Param[3];
     End;
     'n':Begin
      Options:=Options+[OptFields];
      If Length(Param)>2Then FieldList:=Copy(Param,3,255);
     End;
     'o':Begin
      Options:=Options+[OptOutput];
      If I<ParamCount Then Begin
       Param:=ParamStr(I+1);
       If Param[1]<>'-'Then OutputFile:=Param;
      End;
     End;
     '0'..'9':Begin
      Options:=Options+[OptNumber];
      Val(Copy(Param,2,255),Value,Err);
      If Err=0Then MaxRecords:=Value;
     End;
    End;
   End
    Else
   InputFile:=Param;
  End
   Else
  InputFile:=Param;
 End;
End;

BEGIN
 Language:=_French;
 TmpLanguage:=GetEnv('LANGUAGE');
 If TmpLanguage<>''Then Begin
  If TmpLanguage[1]='"'Then TmpLanguage:=Copy(TmpLanguage,2,255);
  If StrToUpper(Copy(TmpLanguage,1,2))='EN'Then Language:=_English Else
  If StrToUpper(Copy(TmpLanguage,1,2))='GR'Then Language:=_Germany Else
  If StrToUpper(Copy(TmpLanguage,1,2))='IT'Then Language:=_Italian Else
  If StrToUpper(Copy(TmpLanguage,1,2))='SP'Then Language:=_Spain;
 End;
 If(ParamStr(1)='/?')or(ParamStr(1)='--help')or(ParamStr(1)='-h')or
   (ParamStr(1)='/h')or(ParamStr(1)='/H')Then Begin
  Case Language of
   _English:Begin
    WriteLn('A2P : This command allows you to translate an AWK script to a PERL script.');
    WriteLn;
    WriteLn('Syntax : A2P [-Dnumber] [-Fcharacter] [-nfieldlist] [-number] [-o] [filename]');
    WriteLn;
    WriteLn(' -D<number>      Set debug level');
    WriteLn(' -F<character>   Set field separator');
    WriteLn(' -n<fieldlist>   Specify field list');
    WriteLn(' -<number>       Maximum number of records');
    WriteLn(' -o              Output to file');
    WriteLn(' filename        AWK script filename');
   End;
   _Germany:Begin
    WriteLn('A2P : Dieser Befehl ermoeglicht die Uebersetzung eines AWK-Skripts in ein PERL-Skript.');
    WriteLn;
    WriteLn('Syntax : A2P [-Dnummer] [-Fzeichen] [-nfeldliste] [-nummer] [-o] [dateiname]');
    WriteLn;
    WriteLn(' -D<nummer>      Debug-Level festlegen');
    WriteLn(' -F<zeichen>     Feldtrenner festlegen');
    WriteLn(' -n<feldliste>   Feldliste angeben');
    WriteLn(' -<nummer>       Maximale Anzahl von Datensaetzen');
    WriteLn(' -o              Ausgabe in Datei');
    WriteLn(' dateiname       AWK-Skript-Dateiname');
   End;
   _Italian:Begin
    WriteLn('A2P : Questo comando permette di tradurre uno script AWK in uno script PERL.');
    WriteLn;
    WriteLn('Sintassi : A2P [-Dnumero] [-Fcarattere] [-nlistacampi] [-numero] [-o] [nomefile]');
    WriteLn;
    WriteLn(' -D<numero>      Imposta il livello di debug');
    WriteLn(' -F<carattere>   Imposta il separatore di campo');
    WriteLn(' -n<listacampi>  Specifica la lista dei campi');
    WriteLn(' -<numero>       Numero massimo di record');
    WriteLn(' -o              Output su file');
    WriteLn(' nomefile        Nome del file script AWK');
   End;
   _Spain:Begin
    WriteLn('A2P : Este comando permite traducir un script AWK a un script PERL.');
    WriteLn;
    WriteLn('Sintaxis : A2P [-Dnumero] [-Fcaracter] [-nlistacampos] [-numero] [-o] [archivo]');
    WriteLn;
    WriteLn(' -D<numero>      Establece el nivel de depuracion');
    WriteLn(' -F<caracter>    Establece el separador de campo');
    WriteLn(' -n<listacampos> Especifica la lista de campos');
    WriteLn(' -<numero>       Numero maximo de registros');
    WriteLn(' -o              Salida a archivo');
    WriteLn(' archivo         Nombre del archivo script AWK');
   End;
   Else Begin
    WriteLn('A2P : Cette commande permet de traduire un script AWK vers un script PERL.');
    WriteLn;
    WriteLn('Syntaxe : A2P [-Dnumber] [-Fcharacter] [-nfieldlist] [-number] [-o] [filename]');
    WriteLn;
    WriteLn(' -D<nombre>      Fixe le niveau de debug');
    WriteLn(' -F<caractere>   Fixe le s‚parateur de champ');
    WriteLn(' -n<listechamp>  Sp‚cifie la liste des champs');
    WriteLn(' -<nombre>       Nombre maximum d''enregistrements');
    WriteLn(' -o              Sortie vers fichier');
    WriteLn(' filename        Nom du fichier script AWK');
   End;
  End;
 End
  Else
 Begin
  Options:=[];
  DebugLevel:=0;
  FieldSeparator:=' ';
  FieldList:='';
  MaxRecords:=0;
  OutputFile:='';
  InputFile:='';
  ParseParameters;
  If InputFile=''Then Begin
   Case Language of
    _English:WriteLn('Usage: A2P [-Dnumber] [-Fcharacter] [-nfieldlist] [-number] [-o] [filename]');
    _Germany:WriteLn('Verwendung: A2P [-Dnummer] [-Fzeichen] [-nfeldliste] [-nummer] [-o] [dateiname]');
    _Italian:WriteLn('Uso: A2P [-Dnumero] [-Fcarattere] [-nlistacampi] [-numero] [-o] [nomefile]');
    _Spain:WriteLn('Uso: A2P [-Dnumero] [-Fcaracter] [-nlistacampos] [-numero] [-o] [archivo]');
    Else WriteLn('Utilisation: A2P [-Dnumber] [-Fcharacter] [-nfieldlist] [-number] [-o] [filename]');
   End;
  End
   Else
  ProcessAWKFile;
 End;
END.